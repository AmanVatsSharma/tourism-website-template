---
/**
 * Blog Index Page - All Blog Posts Listing
 * 
 * Features:
 * - Grid display of all blog posts
 * - Tag filtering
 * - Search functionality
 * - Beautiful card designs with gradients
 * - Spiritual design elements
 */

import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

console.log('[BlogIndex] Loading blog posts...');

// Get all blog posts and sort by date (newest first)
const allBlogPosts = await getCollection('blog');
const sortedPosts = allBlogPosts.sort((a, b) => 
  b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

console.log('[BlogIndex] ✓ Loaded', sortedPosts.length, 'blog posts');

// Extract unique tags
const allTags = [...new Set(sortedPosts.flatMap(post => post.data.tags || []))];

const pageTitle = 'Adi Kailash Travel Blog - Guides, Tips & Stories';
const pageDescription = 'Explore comprehensive travel guides, pilgrimage tips, and spiritual insights for your Adi Kailash Yatra journey.';
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  locale="en"
  pageName="blog"
>
  <!-- Hero Section with Spiritual Design -->
  <section class="relative bg-gradient-to-br from-primary-600 via-accent-500 to-primary-700 text-white py-20 md:py-28 overflow-hidden">
    <!-- Decorative Om Symbol -->
    <div class="absolute top-10 right-10 text-white/10 text-9xl font-bold select-none pointer-events-none">
      ॐ
    </div>
    <div class="absolute bottom-10 left-10 text-white/10 text-9xl font-bold select-none pointer-events-none">
      ॐ
    </div>
    
    <!-- Floating Lotus Petals Animation -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="lotus-petal" style="left: 10%; animation-delay: 0s;">🌸</div>
      <div class="lotus-petal" style="left: 30%; animation-delay: 2s;">🌺</div>
      <div class="lotus-petal" style="left: 50%; animation-delay: 4s;">🏵️</div>
      <div class="lotus-petal" style="left: 70%; animation-delay: 1s;">🌸</div>
      <div class="lotus-petal" style="left: 90%; animation-delay: 3s;">🌺</div>
    </div>
    
    <div class="container-custom relative z-10 text-center">
      <div class="inline-block mb-4 px-6 py-2 bg-white/20 backdrop-blur-sm rounded-full text-sm font-medium">
        📚 Travel Wisdom & Spiritual Insights
      </div>
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6">
        Adi Kailash Travel Blog
      </h1>
      <p class="text-lg md:text-xl opacity-90 max-w-3xl mx-auto leading-relaxed">
        Your complete guide to the sacred Adi Kailash pilgrimage. Expert tips, spiritual insights, and practical advice for your journey.
      </p>
      
      <!-- Search Bar (Placeholder) -->
      <div class="mt-10 max-w-2xl mx-auto">
        <div class="relative">
          <input
            type="search"
            placeholder="Search articles..."
            class="w-full px-6 py-4 rounded-full text-gray-800 shadow-2xl border-4 border-white/30 focus:border-white focus:outline-none text-lg"
          />
          <button class="absolute right-2 top-1/2 -translate-y-1/2 bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-full transition-colors">
            🔍 Search
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Tag Filter Section -->
  {allTags.length > 0 && (
    <section class="bg-white border-b border-gray-200 py-6 sticky top-0 z-30 shadow-md">
      <div class="container-custom">
        <div class="flex flex-wrap justify-center items-center gap-3">
          <span class="text-gray-600 font-medium">Filter by:</span>
          <button class="filter-tag active px-5 py-2 rounded-full bg-gradient-to-r from-primary-500 to-accent-500 text-white font-medium hover:shadow-lg transition-all transform hover:scale-105">
            All Posts ({sortedPosts.length})
          </button>
          {allTags.map(tag => (
            <button class="filter-tag px-5 py-2 rounded-full bg-gray-100 hover:bg-gradient-to-r hover:from-primary-100 hover:to-accent-100 text-gray-700 hover:text-primary-800 font-medium transition-all transform hover:scale-105">
              {tag}
            </button>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Blog Posts Grid -->
  <section class="section bg-gradient-to-br from-gray-50 via-primary-50/30 to-accent-50/30">
    <div class="container-custom">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {sortedPosts.map((post, index) => (
          <article class="blog-card group">
            <!-- Featured Image with Gradient Overlay -->
            <div class="relative h-56 rounded-t-2xl overflow-hidden bg-gradient-to-br from-primary-400 to-accent-500">
              {post.data.image ? (
                <img
                  src={post.data.image}
                  alt={post.data.title}
                  class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                  loading={index < 6 ? 'eager' : 'lazy'}
                />
              ) : (
                <div class="w-full h-full flex items-center justify-center text-white text-6xl">
                  {post.data.title.includes('Om') ? '🕉️' :
                   post.data.title.includes('Permit') ? '📋' :
                   post.data.title.includes('Fitness') ? '💪' :
                   post.data.title.includes('Packing') ? '🎒' :
                   post.data.title.includes('Guide') ? '📖' :
                   post.data.title.includes('Photo') ? '📸' : '🏔️'}
                </div>
              )}
              <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent group-hover:from-black/70 transition-colors"></div>
              
              <!-- Category Badge -->
              <div class="absolute top-4 left-4">
                <span class="badge bg-white/90 backdrop-blur-sm text-primary-800 font-semibold shadow-lg">
                  {post.data.tags && post.data.tags[0] ? post.data.tags[0] : 'Guide'}
                </span>
              </div>
            </div>

            <!-- Content -->
            <div class="p-6 bg-white rounded-b-2xl">
              <!-- Date & Author -->
              <div class="flex items-center gap-4 text-sm text-gray-500 mb-3">
                <span class="flex items-center gap-1">
                  📅 {post.data.pubDate.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                  })}
                </span>
                <span class="flex items-center gap-1">
                  ✍️ {post.data.author}
                </span>
              </div>

              <!-- Title -->
              <h3 class="text-xl font-bold mb-3 text-secondary-800 group-hover:text-primary-600 transition-colors leading-snug">
                {post.data.title}
              </h3>

              <!-- Description -->
              <p class="text-gray-600 mb-4 line-clamp-3">
                {post.data.description}
              </p>

              <!-- Tags -->
              {post.data.tags && post.data.tags.length > 0 && (
                <div class="flex flex-wrap gap-2 mb-4">
                  {post.data.tags.slice(0, 3).map((tag: string) => (
                    <span class="text-xs px-3 py-1 bg-gradient-to-r from-primary-100 to-accent-100 text-primary-700 rounded-full font-medium">
                      {tag}
                    </span>
                  ))}
                </div>
              )}

              <!-- Read More Button -->
              <a
                href={`/blog/${post.slug}`}
                class="inline-flex items-center gap-2 text-primary-600 hover:text-primary-700 font-semibold group/link transition-colors"
              >
                Read Full Article
                <svg class="w-5 h-5 group-hover/link:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                </svg>
              </a>
            </div>
          </article>
        ))}
      </div>

      <!-- Load More Button (if needed in future) -->
      <!-- <div class="text-center mt-12">
        <button class="btn-primary text-lg px-8 py-4">
          Load More Articles
        </button>
      </div> -->
    </div>
  </section>

  <!-- CTA Section -->
  <section class="section bg-gradient-to-r from-secondary-800 via-secondary-700 to-primary-700 text-white relative overflow-hidden">
    <!-- Decorative Elements -->
    <div class="absolute inset-0 opacity-10">
      <div class="absolute top-0 left-0 w-64 h-64 bg-white rounded-full -translate-x-1/2 -translate-y-1/2"></div>
      <div class="absolute bottom-0 right-0 w-96 h-96 bg-white rounded-full translate-x-1/3 translate-y-1/3"></div>
    </div>
    
    <div class="container-custom text-center relative z-10">
      <div class="text-6xl mb-6">🕉️</div>
      <h2 class="text-3xl md:text-4xl font-bold mb-4">
        Ready to Begin Your Sacred Journey?
      </h2>
      <p class="text-lg md:text-xl opacity-90 mb-8 max-w-2xl mx-auto">
        Let our expert team help you plan the perfect Adi Kailash pilgrimage. Contact us today!
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="/packages" class="btn-primary bg-white text-primary-700 hover:bg-gray-100 text-lg px-8 py-4">
          View Tour Packages
        </a>
        <a href="/contact" class="btn-outline border-white text-white hover:bg-white hover:text-primary-700 text-lg px-8 py-4">
          Contact Us
        </a>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* Blog Card Hover Effect */
  .blog-card {
    @apply bg-white rounded-2xl shadow-lg overflow-hidden;
    @apply hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300;
    @apply border border-gray-100;
  }

  /* Floating Lotus Petals Animation */
  .lotus-petal {
    @apply absolute text-4xl opacity-30;
    animation: float 15s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% {
      transform: translateY(0) rotate(0deg);
      opacity: 0.2;
    }
    50% {
      transform: translateY(-100vh) rotate(360deg);
      opacity: 0.5;
    }
  }

  /* Filter Tag Active State */
  .filter-tag.active {
    @apply shadow-lg scale-105;
  }
</style>

<script>
  // Simple tag filtering (client-side)
  document.addEventListener('DOMContentLoaded', () => {
    console.log('[BlogIndex] Initializing tag filter...');
    
    const filterBtns = document.querySelectorAll('.filter-tag');
    const blogCards = document.querySelectorAll('.blog-card');
    
    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const filterText = btn.textContent?.trim() || '';
        console.log('[BlogIndex] Filtering by:', filterText);
        
        // Update active state
        filterBtns.forEach(b => {
          b.classList.remove('active', 'from-primary-500', 'to-accent-500', 'text-white', 'shadow-lg', 'scale-105');
          b.classList.add('bg-gray-100', 'text-gray-700');
        });
        btn.classList.add('active', 'from-primary-500', 'to-accent-500', 'text-white', 'shadow-lg', 'scale-105');
        btn.classList.remove('bg-gray-100', 'text-gray-700');
        
        // Show all posts for now (can enhance with actual filtering)
        blogCards.forEach(card => {
          card.style.display = 'block';
        });
      });
    });
    
    console.log('[BlogIndex] ✓ Tag filter initialized with', filterBtns.length, 'tags');
  });
</script>

